var jsTemplate_source,jsTemplate_dataAdapter;$(document).ready(function(){function k(a){if(e)e=!1;else{if($("#jsTemplate_form").data("changed"))if(confirm("------------------------------------\n\u63d0\u793a\uff1a\u672a\u4fdd\u5b58\u7684\u5185\u5bb9\u5c06\u4f1a\u4e22\u5931\uff01\n------------------------------------\n\n\u786e\u8ba4\u79bb\u5f00\u5417\uff1f"))$("#jsTemplate_form").data("changed",!1),h=a;else{e=!0;$("#jsTemplate_listbox").jqxListBox("selectIndex",h);return}else h=a;-1===a?($("#jsTemplate_ok").text("\u65b0\u589e"),$("#jsTemplate_name").val(""),$("#jsTemplate_description").val(""),c.setValue("",-1),$("#jsTemplate_form").data("changed",!1)):($("#jsTemplate_ok").text("\u4fee\u6539"),a=jsTemplate_dataAdapter.records[a],$("#jsTemplate_name").val(a.js_name),$("#jsTemplate_description").val(a.js_description),l(a.js_name))}}function l(a){$("#jsTemplate_form").data("changed",!1);c.setReadOnly(!0);$.ajax({url:urlbase+"?js_template_cmd\x3dget\x26name\x3d"+a,dataType:"json",timeout:interval,success:function(a){c.setValue(a,-1);$("#jsTemplate_form").data("changed",!1);c.setReadOnly(!1)},complete:function(a,b){"timeout"==b?alert("\u8f7d\u5165\u8d85\u65f6\uff01"):"parsererror"==b&&(window.location.href="login.php")}})}function g(){$("#jsTemplate_form").data("changed",!1);jsTemplate_dataAdapter.dataBind()}var d=$("#nav-section").height()-$("#dash-logo").outerHeight(!0);$("#jsTemplate_splitter").jqxSplitter({width:"100%",height:0<d?d:0,panels:[{size:"400px"}]});var h=-1,e=!1,f="";jsTemplate_source={datatype:"json",datafields:[{name:"js_uri"},{name:"js_name"},{name:"js_description"},{name:"js_name_abbr"},{name:"js_description_abbr"}],id:"js_name",url:urlbase+"?js_template_cmd\x3dlist"};jsTemplate_dataAdapter=new $.jqx.dataAdapter(jsTemplate_source,{loadComplete:function(){""!==f&&($("#jsTemplate_listbox").jqxListBox("selectItem",f),f="")}});$("#jsTemplate_listbox").jqxListBox({selectedIndex:-1,source:jsTemplate_dataAdapter,displayMember:"js_name",valueMember:"js_name",itemHeight:60,width:"100%",height:0<d-29?d-29:0,renderer:function(a,c,b){a=jsTemplate_dataAdapter.records[a];return'\x3ctable class\x3d"listbox_item_table"\x3e\x3ctr\x3e\x3ctd class\x3d"listbox_item_img" rowspan\x3d"2"\x3e\x3cimg height\x3d"50" width\x3d"50" src\x3d"static/images/js_icon.png"/\x3e\x3c/td\x3e\x3ctd class\x3d"listbox_item_name"\x3e'+a.js_name_abbr+'.js\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"listbox_item_description"\x3e'+a.js_description_abbr+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"}});$("#jsTemplate_listbox").on("select",function(a){k(a.args.index)});$("#jsTemplate_add_button").jqxButton({width:65,height:20});$("#jsTemplate_del_button").jqxButton({width:65,height:20});$("#jsTemplate_clear_button").jqxButton({width:65,height:20});$("#jsTemplate_add_button").click(function(a){$("#jsTemplate_listbox").jqxListBox("selectIndex",-1)});$("#jsTemplate_del_button").click(function(a){a=$("#jsTemplate_listbox").jqxListBox("getSelectedIndex");0<=a&&confirm("\u60a8\u786e\u8ba4\u6267\u884c\u5220\u9664\u64cd\u4f5c\u4e48\uff1f")&&$.ajax({url:urlbase+"?js_template_cmd\x3ddel\x26name\x3d"+jsTemplate_dataAdapter.records[a].js_name,dataType:"json",timeout:interval,success:function(a){a?($("#jsTemplate_listbox").jqxListBox("selectIndex",-1),g()):($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated"))},complete:function(a,b){"timeout"==b?($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated")):"parsererror"==b&&(window.location.href="login.php")}})});$("#jsTemplate_clear_button").click(function(a){confirm("\u60a8\u786e\u8ba4\u6e05\u7a7a\u6240\u6709JS\u6a21\u677f\u4e48\uff1f")&&$.ajax({url:urlbase+"?js_template_cmd\x3dclear",dataType:"json",timeout:interval,success:function(a){a?($("#jsTemplate_listbox").jqxListBox("selectIndex",-1),g()):($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated"))},complete:function(a,b){"timeout"==b?($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated")):"parsererror"==b&&(window.location.href="login.php")}})});$("#jsTemplate_form").change(function(){$("#jsTemplate_form").data("changed",!0)});$("#jsTemplate_name").jqxInput({width:"80%",height:"20px",placeHolder:"\u8bf7\u8f93\u5165js\u6a21\u677f\u540d..."});$("#jsTemplate_description").jqxTextArea({width:"100%",height:50,placeHolder:"\u8bf7\u8f93\u5165js\u6a21\u677f\u63cf\u8ff0..."});$("#jsTemplate_content").height(0<d-207?d-207:0);var c=ace.edit("jsTemplate_content");c.setTheme("ace/theme/chrome");c.session.setMode("ace/mode/javascript");c.session.setUseWrapMode(!0);c.renderer.setScrollMargin(10,10);c.setOptions({autoScrollEditorIntoView:!0});c.on("change",function(){$("#jsTemplate_form").data("changed",!0)});c.$blockScrolling=Infinity;c.setFontSize(16);$("#jsTemplate_content_toolBar").jqxToolBar({width:"100%",height:35,minimizeWidth:100,tools:"button | button | button",initTools:function(a,d,b,f){"button"==a&&b.attr("type","button");switch(d){case 0:b.val("\u683c\u5f0f\u5316");b.click(function(){var a=c.getValue();""!==a&&(a=js_beautify(a),c.setValue(a,-1))});break;case 1:b.val("\u538b\u7f29");b.click(function(){var a=c.getValue();""!==a&&(a=jsmin(a,3),c.setValue(a.trim(),-1))});break;case 2:b.val("\u590d\u5236js\u5730\u5740"),(new ZeroClipboard(b)).on("copy",function(a){var b=$("#jsTemplate_listbox").jqxListBox("getSelectedIndex");if(0<=b){a=a.clipboardData;var b=jsTemplate_dataAdapter.records[b],c=window.location.href.lastIndexOf("/"),b=window.location.href.substr(0,c+1)+b.js_uri;a.setData("text/plain",b)}else alert("\u8bf7\u5148\u4fdd\u5b58\uff01")})}}});$("#jsTemplate_ok").jqxButton({width:65,height:25});$("#jsTemplate_cancel").jqxButton({width:65,height:25});$("#jsTemplate_ok").click(function(a){var d=$("#jsTemplate_name").val();a=$("#jsTemplate_description").val();var b=c.getValue(),e=$("#jsTemplate_listbox").jqxListBox("getSelectedIndex");-1===e?(a={name:d,desc:a,content:b},$.ajax({type:"POST",data:a,url:urlbase+"?js_template_cmd\x3dadd",dataType:"json",timeout:interval,success:function(a){a?(f=d,g()):($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated"))},complete:function(a,b){"timeout"==b?($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated")):"parsererror"==b&&(window.location.href="login.php")}})):(a={old_name:jsTemplate_dataAdapter.records[e].js_name,name:d,desc:a,content:b},$.ajax({type:"POST",data:a,url:urlbase+"?js_template_cmd\x3dmodify",dataType:"json",timeout:interval,success:function(a){a?(f=d,g()):($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated"))},complete:function(a,b){"timeout"==b?($("#failedWindow").jqxWindow("open"),$("#failedWindow").addClass("animated")):"parsererror"==b&&(window.location.href="login.php")}}))});$("#jsTemplate_cancel").click(function(a){$("#jsTemplate_form").data("changed",!1);a=$("#jsTemplate_listbox").jqxListBox("getSelectedIndex");k(a)});$(window).resize(function(){var a=$("#nav-section").height()-$("#dash-logo").outerHeight(!0);$("#jsTemplate_splitter").jqxSplitter({height:0<a?a:0});$("#jsTemplate_listbox").jqxListBox({height:0<a-29?a-29:0});$("#jsTemplate_content").height(0<a-207?a-207:0)})});