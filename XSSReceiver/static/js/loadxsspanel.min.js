var urlbase="./api.php",messageList=null,setIntervalID=null,interval=2E3;$(document).ready(function(){var a=this,e=$("#nav-section").height()-$("#dash-logo").outerHeight(!0);$("#deleteConfirmWindow").jqxWindow({height:100,width:270,resizable:!1,isModal:!0,modalOpacity:.3,okButton:$("#deleteConfirm_ok"),cancelButton:$("#deleteConfirm_cancel"),autoOpen:!1});$("#deleteConfirm_ok").jqxButton({width:"65px"});$("#deleteConfirm_cancel").jqxButton({width:"65px"});$("#deleteConfirmWindow").on("close",function(b){if(b.args.dialogResult.OK){b=$("#panelGrid").jqxGrid("getselectedrowindex");var g=$("#panelGrid").jqxGrid("getrowid",b);$.ajax({url:urlbase+"?cmd\x3ddel\x26id\x3d"+g,dataType:"json",timeout:interval,success:function(b){1==b?$("#panelGrid").jqxGrid("deleterow",g):$("#failedWindow").jqxWindow("open")},complete:function(b,g){"timeout"==g?$("#failedWindow").jqxWindow("open"):"parsererror"==g&&(window.location.href="login.php")}})}});$("#clearConfirmWindow").jqxWindow({height:100,width:270,resizable:!1,isModal:!0,modalOpacity:.3,okButton:$("#clearConfirm_ok"),cancelButton:$("#clearConfirm_cancel"),autoOpen:!1});$("#clearConfirm_ok").jqxButton({width:"65px"});$("#clearConfirm_cancel").jqxButton({width:"65px"});$("#clearConfirmWindow").on("close",function(b){b.args.dialogResult.OK&&$.ajax({url:urlbase+"?cmd\x3dclear",dataType:"json",timeout:interval,success:function(b){1==b?$("#panelGrid").jqxGrid("clear"):$("#failedWindow").jqxWindow("open")},complete:function(b,a){"timeout"==a?$("#failedWindow").jqxWindow("open"):"parsererror"==a&&(window.location.href="login.php")}})});$("#logoutConfirmWindow").jqxWindow({height:100,width:270,resizable:!1,isModal:!0,modalOpacity:.3,okButton:$("#logoutConfirm_ok"),cancelButton:$("#logoutConfirm_cancel"),autoOpen:!1});$("#logoutConfirm_ok").jqxButton({width:"65px"});$("#logoutConfirm_cancel").jqxButton({width:"65px"});$("#logoutConfirmWindow").on("close",function(b){b.args.dialogResult.OK&&(window.location.href="logout.php")});$("#logout").click(function(b){$("#logoutConfirmWindow").jqxWindow("open");b.preventDefault()});$("#failedWindow").jqxWindow({height:100,width:270,resizable:!1,isModal:!0,modalOpacity:.3,okButton:$("#failed_ok"),autoOpen:!1});$("#failed_ok").jqxButton({width:"65px"});$("#searchWindow").jqxWindow({resizable:!1,autoOpen:!1,isModal:!0,modalOpacity:.3,width:210,height:180});$("#findButton").jqxButton({width:70});$("#clearButton").jqxButton({width:70});$("#dropdownlist").jqxDropDownList({autoDropDownHeight:!0,selectedIndex:0,width:200,height:23,source:"\u65f6\u95f4 IP \u6765\u6e90 \u5ba2\u6237\u7aef \u8bf7\u6c42 \u643a\u5e26\u6570\u636e \u4fdd\u6301\u8fde\u63a5".split(" ")});$("#findButton").click(function(){$("#panelGrid").jqxGrid("clearfilters");var b="";switch($("#dropdownlist").jqxDropDownList("selectedIndex")){case 0:b="request_date_and_time_string";break;case 1:b="user_IP";break;case 2:b="location";break;case 3:b="client";break;case 4:b="request_method";break;case 5:b="data_type";break;case 6:b="keepsession"}var g=$("#search_input_field").val(),a=new $.jqx.filter,g=a.createfilter("stringfilter",g,"contains");a.addfilter(1,g);$("#panelGrid").jqxGrid("addfilter",b,a);$("#panelGrid").jqxGrid("applyfilters")});$("#clearButton").click(function(){$("#panelGrid").jqxGrid("clearfilters")});$(window).resize(function(){var b=$("#nav-section").height()-$("#dash-logo").outerHeight(!0);$("#panelGrid").jqxGrid({height:0<b?b:0})});var c=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"user_IP"},{name:"location"},{name:"data_type"},{name:"keepsession"},{name:"user_port"},{name:"protocol"},{name:"request_method"},{name:"request_URI"},{name:"request_time"},{name:"headers_data"},{name:"get_data"},{name:"post_data"},{name:"cookie_data"},{name:"decoded_get_data"},{name:"decoded_post_data"},{name:"decoded_cookie_data"},{name:"request_date_string"},{name:"request_time_string"},{name:"request_date_and_time_string"},{name:"client"}],id:"request_time",url:urlbase+"?cmd\x3dlist",root:"data"},{downloadComplete:function(b,a,c){if("success"==a){for(a=b.length;a--;){c=new Date(1E3*b[a].request_time);b[a].request_date_string=c.getFullYear()+"\u5e74"+(c.getMonth()+1)+"\u6708"+c.getDate()+"\u65e5";b[a].request_time_string=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();b[a].request_date_and_time_string=b[a].request_date_string+" "+b[a].request_time_string;b[a].keepsession=!0===b[a].keepsession?"\u662f":"\u5426";b[a].client=b[a].headers_data["User-Agent"]?get_client_info(b[a].headers_data["User-Agent"]):"\u672a\u77e5";c={};var d=Object.keys(b[a].get_data),e=Object.keys(b[a].post_data),l=Object.keys(b[a].cookie_data);0<d.length&&(c.GET=d);0<e.length&&(c.POST=e);0<l.length&&(c.COOKIE=l);b[a].data_type=JSON.stringify(c)}return b}}});$("#panelGrid").jqxGrid({pageable:!0,ready:function(){checkNewMessages();setIntervalID=setInterval(checkNewMessages,interval)},pagerrenderer:function(){var b=$("\x3cdiv style\x3d'overflow: hidden; position: relative; '\x3e\x3c/div\x3e"),g=$("\x3cdiv style\x3d'float: left; margin-left: 5px;'\x3e\x3cimg style\x3d'position: relative; margin-top: 2px;' src\x3d'static/images/delete.png'/\x3e\x3cspan style\x3d'margin-left: 4px; position: relative; top: 3px;'\x3e\u5220\u9664\x3c/span\x3e\x3c/div\x3e"),c=$("\x3cdiv style\x3d'float: left; margin-left: 5px;'\x3e\x3cimg style\x3d'position: relative; margin-top: 2px;' src\x3d'static/images/clear.png'/\x3e\x3cspan style\x3d'margin-left: 4px; position: relative; top: 3px;'\x3e\u6e05\u7a7a\x3c/span\x3e\x3c/div\x3e"),d=$("\x3cdiv style\x3d'float: left; margin-left: 5px;'\x3e\x3cimg style\x3d'position: relative; margin-top: 2px;' src\x3d'static/images/search.png'/\x3e\x3cspan style\x3d'margin-left: 4px; position: relative; top: 3px;'\x3e\u67e5\u8be2\x3c/span\x3e\x3c/div\x3e");b.append(g);b.append(c);b.append(d);g.jqxButton({width:65,height:20});c.jqxButton({width:65,height:20});d.jqxButton({width:65,height:20});g.click(function(b){0<=$("#panelGrid").jqxGrid("getselectedrowindex")&&$("#deleteConfirmWindow").jqxWindow("open")});c.click(function(b){$("#clearConfirmWindow").jqxWindow("open")});d.click(function(b){$("#searchWindow").jqxWindow("open")});var g=$("\x3cdiv style\x3d'overflow: hidden;float: right;position: relative;margin: 5.5px; '\x3e\x3c/div\x3e"),c=$("#panelGrid").jqxGrid("getdatainformation"),d=c.paginginformation,e=$("\x3cdiv style\x3d'padding: 0px; float: left;'\x3e\x3cdiv style\x3d'margin-left: 9px; width: 16px; height: 16px;'\x3e\x3c/div\x3e\x3c/div\x3e");e.find("div").addClass("jqx-icon-arrow-left");e.width(36);e.jqxButton({theme:"energyblue"});var l=$("\x3cdiv style\x3d'padding: 0px; margin: 0px 3px; float: left;'\x3e\x3cdiv style\x3d'margin-left: 9px; width: 16px; height: 16px;'\x3e\x3c/div\x3e\x3c/div\x3e");l.find("div").addClass("jqx-icon-arrow-right");l.width(36);l.jqxButton({theme:"energyblue"});var m=$("\x3cdiv style\x3d'font-size: 14px; margin: 1px 1px; font-weight: bold; float: left;'\x3e\x3c/div\x3e");m.text("1-"+d.pagesize+" of "+c.rowscount);e.appendTo(g);l.appendTo(g);m.appendTo(g);g.appendTo(b);a.label=m;l.click(function(){$("#panelGrid").jqxGrid("gotonextpage")});e.click(function(){$("#panelGrid").jqxGrid("gotoprevpage")});return b},scrollmode:"logical",sortable:!0,pagesize:25,localization:getLocalization("zh"),width:"100%",height:0<e-2?e-2:0,source:c,enablebrowserselection:!0,columnsresize:!0,rowdetails:!0,rowdetailstemplate:{rowdetails:$("#xss-detail-template").html(),rowdetailsheight:222},initrowdetails:function(b,a,c,d){var e=c=b=null,l=null,m=null,n=null;b=$($(a).children()[0]);if(null!==b){c=b.find(".information");var e=b.find(".get_grid"),l=b.find(".post_grid"),m=b.find(".cookie_grid"),n=b.find(".headers_grid"),h=[],f;for(f in d.get_data){var k=[];k.push(f);k.push(d.get_data[f]);a="";d.decoded_get_data&&(a=d.decoded_get_data[f]);k.push(a);h.push(k)}var p={localdata:h,datafields:[{name:"key",type:"string",map:"0"},{name:"value",type:"string",map:"1"},{name:"decoded_value",type:"string",map:"2"}],datatype:"array"};a=new $.jqx.dataAdapter(p);e.jqxGrid({autorowheight:!0,columnsautoresize:!0,pageable:!0,pagermode:"simple",scrollmode:"deferred",localization:getLocalization("zh"),enablebrowserselection:!0,columnsresize:!0,height:176,width:"100%",source:a,ready:function(){p.localdata.length&&0<p.localdata.length&&e.jqxGrid("autoresizecolumn","key")},columns:d.decoded_get_data?[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"},{text:"\u89e3\u7801",datafield:"decoded_value"}]:[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"}]});h=[];for(f in d.post_data)k=[],k.push(f),k.push(d.post_data[f]),a="",d.decoded_post_data&&(a=d.decoded_post_data[f]),k.push(a),h.push(k);var q={localdata:h,datafields:[{name:"key",type:"string",map:"0"},{name:"value",type:"string",map:"1"},{name:"decoded_value",type:"string",map:"2"}],datatype:"array"};a=new $.jqx.dataAdapter(q);l.jqxGrid({ready:function(){q.localdata.length&&0<q.localdata.length&&l.jqxGrid("autoresizecolumn","key")},autorowheight:!0,pageable:!0,columnsautoresize:!0,pagermode:"simple",scrollmode:"deferred",localization:getLocalization("zh"),enablebrowserselection:!0,columnsresize:!0,height:176,width:"100%",source:a,columns:d.decoded_post_data?[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"},{text:"\u89e3\u7801",datafield:"decoded_value"}]:[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"}]});h=[];for(f in d.cookie_data)k=[],k.push(f),k.push(d.cookie_data[f]),a="",d.decoded_cookie_data&&(a=d.decoded_cookie_data[f]),k.push(a),h.push(k);var r={localdata:h,datafields:[{name:"key",type:"string",map:"0"},{name:"value",type:"string",map:"1"},{name:"decoded_value",type:"string",map:"2"}],datatype:"array"};a=new $.jqx.dataAdapter(r);m.jqxGrid({ready:function(){r.localdata.length&&0<r.localdata.length&&m.jqxGrid("autoresizecolumn","key")},columnsautoresize:!0,autorowheight:!0,pageable:!0,pagermode:"simple",scrollmode:"deferred",localization:getLocalization("zh"),enablebrowserselection:!0,columnsresize:!0,height:176,width:"100%",source:a,columns:d.decoded_cookie_data?[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"},{text:"\u89e3\u7801",datafield:"decoded_value"}]:[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"}]});a=[];for(f in d.headers_data)h=[],h.push(f),h.push(d.headers_data[f]),a.push(h);var t={localdata:a,datafields:[{name:"key",type:"string",map:"0"},{name:"value",type:"string",map:"1"}],datatype:"array"};f=new $.jqx.dataAdapter(t);n.jqxGrid({ready:function(){t.localdata.length&&0<t.localdata.length&&n.jqxGrid("autoresizecolumn","key")},columnsautoresize:!0,autorowheight:!0,pageable:!0,pagermode:"simple",scrollmode:"deferred",localization:getLocalization("zh"),enablebrowserselection:!0,columnsresize:!0,width:"100%",height:176,source:f,columns:[{text:"\u952e",datafield:"key"},{text:"\u503c",datafield:"value"}]});a=$('\x3cdiv style\x3d"margin: 25px;"\x3e\x3c/div\x3e');a.appendTo($(c));f=$('\x3cdiv style\x3d"float: left; width: 45%;"\x3e\x3c/div\x3e');c=$('\x3cdiv style\x3d"float: left; width: 40%;"\x3e\x3c/div\x3e');a.append(f);a.append(c);a="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u65e5\u671f\uff1a\x3c/b\x3e "+d.request_date_string+"\x3c/div\x3e";var h="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3eIP\uff1a\x3c/b\x3e "+d.user_IP+"\x3c/div\x3e",k="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u534f\u8bae\uff1a\x3c/b\x3e "+d.request_method+"\x3c/div\x3e",u="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u4f4d\u7f6e\uff1a\x3c/b\x3e "+d.location+"\x3c/div\x3e";$(f).append(a);$(f).append(h);$(f).append(k);$(f).append(u);f="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u65f6\u95f4\uff1a\x3c/b\x3e "+d.request_time_string+"\x3c/div\x3e";a="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u7aef\u53e3\uff1a\x3c/b\x3e "+d.user_port+"\x3c/div\x3e";h="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u8bbf\u95ee\u5730\u5740\uff1a\x3c/b\x3e "+d.request_URI+"\x3c/div\x3e";d="\x3cdiv style\x3d'margin: 10px;'\x3e\x3cb\x3e\u5ba2\u6237\u7aef\uff1a\x3c/b\x3e "+d.client+"\x3c/div\x3e";$(c).append(f);$(c).append(a);$(c).append(h);$(c).append(d);$(b).jqxTabs({width:"95%",height:"100%"})}},columns:[{text:"\u65f6\u95f4",datafield:"request_date_and_time_string",width:165},{text:"IP",datafield:"user_IP"},{text:"\u6765\u6e90",datafield:"location"},{text:"\u5ba2\u6237\u7aef",datafield:"client"},{text:"\u8bf7\u6c42",datafield:"request_method",width:55},{text:"\u643a\u5e26\u6570\u636e",datafield:"data_type"},{text:"\u4fdd\u6301\u8fde\u63a5",datafield:"keepsession",width:60,cellsalign:"center"}]});$("#panelGrid").on("pagechanged",function(){var b=$("#panelGrid").jqxGrid("getdatainformation"),c=b.paginginformation;a.label.text(1+c.pagenum*c.pagesize+"-"+Math.min(b.rowscount,(c.pagenum+1)*c.pagesize)+" of "+b.rowscount)})});function checkNewMessages(){$.ajax({url:urlbase+"?cmd\x3did_list",dataType:"json",timeout:interval,success:function(a){if(messageList){var e=0,c=null,b;for(b in a)0>messageList.indexOf(a[b])&&(e++,c=a[b]);0<e&&showNotification(e,c,interval)}messageList=a},complete:function(a,e){"timeout"==e?(interval*=2,setIntervalID&&(clearInterval(setIntervalID),3E4>interval&&(setIntervalID=setInterval(checkNewMessages,interval)))):"parsererror"==e&&(window.location.href="login.php")}})}function get_client_info(a){var e="\u672a\u77e5\u6d4f\u89c8\u5668",c="";0<a.indexOf("Firefox/")?(c=a.match(/Firefox\/([^;)]+)+/i),e="Firefox",c=c[1]):0<a.indexOf("Maxthon")?(c=a.match(/Maxthon\/([\d\.]+)/),e="\u50b2\u6e38",c=c[1]):0<a.indexOf("MSIE")?(c=a.match(/MSIE\s+([^;)]+)+/i),e="IE",c=c[1]):0<a.indexOf("OPR")?(c=a.match(/OPR\/([\d\.]+)/),e="Opera",c=c[1]):0<a.indexOf("Edge")?(c=a.match(/Edge\/([\d\.]+)/),e="Edge",c=c[1]):0<a.indexOf("Chrome")?(c=a.match(/Chrome\/([\d\.]+)/),e="Chrome",c=c[1]):0<a.indexOf("rv:")&&0<a.indexOf("Gecko")&&(c=a.match(/rv:([\d\.]+)/),e="IE",c=c[1]);var c=c.match(/^[0-9\.]+$/)?c:"\u672a\u77e5",b="\u672a\u77e5\u64cd\u4f5c\u7cfb\u7edf";a.match(/win/i)&&0<a.indexOf("95")?b="Windows 95":a.match(/win 9x/i)&&0<a.indexOf("4.90")?b="Windows ME":a.match(/win/i)&&a.match(/98/i)?b="Windows 98":a.match(/win/i)&&a.match(/nt 6.0/i)?b="Windows Vista":a.match(/win/i)&&a.match(/nt 6.1/i)?b="Windows 7":a.match(/win/i)&&a.match(/nt 6.2/i)?b="Windows 8":a.match(/win/i)&&a.match(/nt 10.0/i)?b="Windows 10":a.match(/win/i)&&a.match(/nt 5.1/i)?b="Windows XP":a.match(/win/i)&&a.match(/nt 5/i)?b="Windows 2000":a.match(/win/i)&&a.match(/nt/i)?b="Windows NT":a.match(/win/i)&&a.match(/32/i)?b="Windows 32":a.match(/linux/i)?b="Linux":a.match(/unix/i)?b="Unix":a.match(/sun/i)&&a.match(/os/i)?b="SunOS":a.match(/ibm/i)&&a.match(/os/i)?b="IBM OS/2":a.match(/Mac/i)&&a.match(/PC/i)?b="Macintosh":a.match(/PowerPC/i)?b="PowerPC":a.match(/AIX/i)?b="AIX":a.match(/HPUX/i)?b="HPUX":a.match(/NetBSD/i)?b="NetBSD":a.match(/BSD/i)?b="BSD":a.match(/OSF1/i)?b="OSF1":a.match(/IRIX/i)?b="IRIX":a.match(/FreeBSD/i)?b="FreeBSD":a.match(/teleport/i)?b="teleport":a.match(/flashget/i)?b="flashget":a.match(/webzip/i)?b="webzip":a.match(/offline/i)&&(b="offline");return b+" "+e+"("+c+")"};